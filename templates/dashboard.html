<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FLUX Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 900px; 
            margin: 50px auto; 
            padding: 20px; 
            background-color: #f4f4f4; 
        }
        header { 
            text-align: center; 
            background: #007bff; 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 30px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: bold;
        }
        .logout-link {
            color: white;
            font-weight: bold;
            text-decoration: none;
            font-size: 1.2em;
        }
        .logout-link:hover {
            color: #0056b3;
        }
        .nav-links {
            background: white;
            margin: 20px 0;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }
        .welcome-text {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #007bff;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: normal;
            opacity: 0.8;
        }
        .nav-links a {
            display: inline-block;
            margin: 0 15px;
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .nav-links a:hover {
            color: #0056b3;
        }
        .nav-links i {
            font-size: 1.2em;
            margin-right: 5px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        .nav-links a:hover i {
            opacity: 1;
        }
        section { 
            background: white; 
            margin: 20px 0; 
            border-radius: 8px; 
            padding: 20px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        input, textarea, select, button { 
            padding: 10px; 
            margin: 5px 0; 
            width: calc(100% - 22px); 
            box-sizing: border-box; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-weight: bold; 
        }
        button:hover { background: #0056b3; }
        .question-div { 
            border: 1px solid #ddd; 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 4px; 
            background: #fafafa; 
            position: relative; 
        }
        .options-group { 
            margin-left: 20px; 
            display: none; 
        }
        .options-group input { width: calc(100% - 22px); }
        .remove-btn { 
            background: #dc3545; 
            color: white; 
            padding: 5px 10px; 
            font-size: 12px; 
            position: absolute; 
            top: 10px; 
            right: 10px; 
        }
        .remove-btn:hover { background: #c82333; }
        a { 
            color: #007bff; 
            text-decoration: none; 
            margin: 0 10px; 
        }
        a:hover { text-decoration: underline; }
        .flash { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .add-btn { 
            background: #28a745; 
            color: white; 
            padding: 10px 20px; 
            margin: 10px 0; 
        }
        footer {
            text-align: center;
            margin-top: 40px;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <header>
        <a href="{{ url_for('logout') }}" class="logout-link"><i class="fas fa-sign-out-alt"></i></a>
        <h1>FLUX</h1>
        <div style="width: 30px;"></div>
    </header>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="flash">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if user.role == 'master' %}
        <div class="nav-links">
            <div class="welcome-text">Welcome to FLUX Master Dashboard</div>
            <a href="{{ url_for('quizzes') }}"><i class="fas fa-list"></i> View My Quizzes</a>
            <a href="{{ url_for('my_results') }}"><i class="fas fa-chart-bar"></i> Analytics</a>
            <a href="{{ url_for('leaderboard') }}"><i class="fas fa-trophy"></i> Leaderboard</a>
        </div>

        <section>
            <h2>Create Quiz</h2>
            <form id="quizForm" method="POST" action="{{ url_for('create_quiz') }}">
                <input type="text" name="title" placeholder="Quiz Title" required>
                <input type="text" name="subject" placeholder="Subject" required>
                <input type="number" name="duration" min="1" placeholder="Duration (minutes)" required>
                
                <h3>Questions (Dynamic - Add/Remove as Needed)</h3>
                <div id="questions-container">
                    <!-- Initial 1 question -->
                    <div class="question-div" data-qnum="1">
                        <button type="button" class="remove-btn" onclick="removeQuestion(1)" style="display: none;">Remove</button>
                        <h4>Question 1</h4>
                        <select name="q_type_1" onchange="toggleOptions(1)">
                            <option value="mcq">Multiple Choice (MCQ)</option>
                            <option value="tf">True/False</option>
                            <option value="short">Short Answer</option>
                        </select><br>
                        <textarea name="q_text_1" placeholder="Enter question text here" rows="2" required></textarea><br>
                        <input type="text" name="q_answer_1" placeholder="Correct answer" required><br>
                        <input type="number" name="q_points_1" value="1" min="1" max="10" placeholder="Points"><br>
                        
                        <div id="options_1" class="options-group">
                            <label>Options for MCQ (at least 2):</label><br>
                            <input type="text" name="option_1_1" placeholder="Option 1"><br>
                            <input type="text" name="option_1_2" placeholder="Option 2"><br>
                            <input type="text" name="option_1_3" placeholder="Option 3"><br>
                            <input type="text" name="option_1_4" placeholder="Option 4">
                        </div>
                    </div>
                </div>
                
                <button type="button" class="add-btn" onclick="addQuestion()">Add Question</button>
                <p><small>Max 50 questions. Only filled questions will be saved.</small></p>
                
                <button type="submit">Create Quiz</button>
            </form>
        </section>
    {% else %}
        <div class="nav-links">
            <div class="welcome-text">Student Dashboard</div>
            <a href="{{ url_for('quizzes') }}"><i class="fas fa-list"></i> Browse Available Quizzes</a>
            <a href="{{ url_for('my_results') }}"><i class="fas fa-chart-line"></i> My Results</a>
            <a href="{{ url_for('leaderboard') }}"><i class="fas fa-trophy"></i> Leaderboard</a>
        </div>

        <section>
            <p>Ready to take quizzes?</p>
        </section>
    {% endif %}

    <footer>
        &copy; Reserved to Rohithdega
    </footer>

    <script>
        let questionCount = 1;  // Start with 1
        
        function toggleOptions(qNum) {
            const type = document.querySelector(`select[name="q_type_${qNum}"]`).value;
            const optionsDiv = document.getElementById(`options_${qNum}`);
            if (type === 'mcq') {
                optionsDiv.style.display = 'block';
            } else {
                optionsDiv.style.display = 'none';
            }
        }
        
        function addQuestion() {
            if (questionCount >= 50) {
                alert('Max 50 questions reached!');
                return;
            }
            questionCount++;
            const container = document.getElementById('questions-container');
            const newDiv = document.createElement('div');
            newDiv.className = 'question-div';
            newDiv.dataset.qnum = questionCount;
            newDiv.innerHTML = `
                <button type="button" class="remove-btn" onclick="removeQuestion(${questionCount})">Remove</button>
                <h4>Question ${questionCount}</h4>
                <select name="q_type_${questionCount}" onchange="toggleOptions(${questionCount})">
                    <option value="mcq">Multiple Choice (MCQ)</option>
                    <option value="tf">True/False</option>
                    <option value="short">Short Answer</option>
                </select><br>
                <textarea name="q_text_${questionCount}" placeholder="Enter question text here" rows="2" required></textarea><br>
                <input type="text" name="q_answer_${questionCount}" placeholder="Correct answer" required><br>
                <input type="number" name="q_points_${questionCount}" value="1" min="1" max="10" placeholder="Points"><br>
                
                <div id="options_${questionCount}" class="options-group">
                    <label>Options for MCQ (at least 2):</label><br>
                    <input type="text" name="option_${questionCount}_1" placeholder="Option 1"><br>
                    <input type="text" name="option_${questionCount}_2" placeholder="Option 2"><br>
                    <input type="text" name="option_${questionCount}_3" placeholder="Option 3"><br>
                    <input type="text" name="option_${questionCount}_4" placeholder="Option 4">
                </div>
            `;
            container.appendChild(newDiv);
            toggleOptions(questionCount);  // Init for new
        }
        
        function removeQuestion(qNum) {
            if (questionCount <= 1) {
                alert('At least one question required!');
                return;
            }
            const div = document.querySelector(`[data-qnum="${qNum}"]`);
            div.remove();
            // Renumber remaining (simple, or skip for backend loop)
            questionCount--;
        }
        
        // Init for first question
        toggleOptions(1);
    </script>
</body>
</html>
